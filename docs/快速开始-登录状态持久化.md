# 快速开始：保存并使用登录状态

## 5分钟上手指南

### 步骤 1：保存登录状态

打开终端，执行以下命令：

```bash
cd c:\AI\testserver\backend
python save_auth_state.py --project-id 1 --url https://fanyi.baidu.com
```

### 步骤 2：在浏览器中登录

命令执行后会自动打开浏览器，在浏览器中：
1. 输入用户名和密码
2. 点击登录
3. 确认登录成功

### 步骤 3：保存状态

回到终端，按 **Enter** 键，系统会自动保存登录状态：

```
✅ 认证状态已保存（包含 5 个 cookies）
📁 文件路径: backend/auth_states/project_1_auth.json
🍪 Cookies 数量: 5
🌐 域名数量: 2
```

### 步骤 4：修改测试用例

编辑测试用例，**删除登录相关步骤**，直接从登录后的操作开始：

**修改前：**
```json
{
  "steps": [
    {"index": 1, "action": "goto", "value": "https://fanyi.baidu.com"},
    {"index": 2, "action": "click", "selector": "#login-btn"},
    {"index": 3, "action": "fill", "selector": "#username", "value": "admin"},
    {"index": 4, "action": "fill", "selector": "#password", "value": "password"},
    {"index": 5, "action": "click", "selector": "#submit"},
    {"index": 6, "action": "click", "selector": "#pro-translation"}
  ]
}
```

**修改后（删除步骤2-5）：**
```json
{
  "steps": [
    {"index": 1, "action": "goto", "value": "https://fanyi.baidu.com"},
    {"index": 2, "action": "click", "selector": "#pro-translation"}
  ]
}
```

### 步骤 5：执行测试

点击"执行"按钮，系统会：
1. ✅ 自动检测到保存的登录状态
2. ✅ 加载登录状态到浏览器
3. ✅ 直接执行测试步骤（跳过登录）

## 日常使用流程

### 第一次使用

```bash
# 1. 保存登录状态（只需执行一次）
python save_auth_state.py --project-id 1 --url https://your-site.com

# 2. 编辑测试用例，删除登录步骤
# 3. 执行测试
```

### 后续使用

直接执行测试即可，系统会自动使用保存的登录状态！

### 登录过期时

如果测试失败提示"未登录"：

```bash
# 重新保存登录状态
python save_auth_state.py --project-id 1 --url https://your-site.com
```

## 常见场景

### 场景 1：测试百度翻译

```bash
# 保存登录状态
python save_auth_state.py --project-id 1 --url https://fanyi.baidu.com

# 测试脚本
{
  "steps": [
    {"index": 1, "action": "goto", "value": "https://fanyi.baidu.com"},
    {"index": 2, "action": "click", "selector": "#pro-translation"},
    {"index": 3, "action": "fill", "selector": "#textarea", "value": "Hello"},
    {"index": 4, "action": "click", "selector": "#translate-btn"}
  ]
}
```

### 场景 2：测试后台管理系统

```bash
# 保存管理员登录状态
python save_auth_state.py --project-id 2 --url https://admin.example.com

# 测试脚本
{
  "steps": [
    {"index": 1, "action": "goto", "value": "https://admin.example.com/dashboard"},
    {"index": 2, "action": "click", "selector": "#users"},
    {"index": 3, "action": "click", "selector": "#add-user"}
  ]
}
```

## 提示和技巧

### ✅ DO（推荐做法）

- 为每个项目保存独立的登录状态
- 定期更新登录状态（建议每周一次）
- 测试脚本中添加登录状态验证步骤
- 将 `auth_states/` 添加到 `.gitignore`

### ❌ DON'T（避免做法）

- 不要提交认证状态文件到版本控制
- 不要多个项目共享同一个认证状态
- 不要在测试脚本中硬编码密码

## 故障排查

### 问题：测试失败提示"未登录"

**解决方案：**
```bash
# 1. 检查认证状态是否存在
ls backend/auth_states/

# 2. 如果不存在，重新保存
python save_auth_state.py --project-id 1 --url https://your-site.com

# 3. 如果存在但过期，删除后重新保存
rm backend/auth_states/project_1_auth.json
python save_auth_state.py --project-id 1 --url https://your-site.com
```

### 问题：保存失败

**解决方案：**
```bash
# 1. 确保目录存在
mkdir backend/auth_states

# 2. 检查权限
chmod 755 backend/auth_states

# 3. 重试
python save_auth_state.py --project-id 1 --url https://your-site.com
```

## 下一步

- 📖 阅读完整的[登录状态持久化使用指南](./登录状态持久化使用指南.md)
- 🧪 尝试创建更多测试用例
- 💡 探索 Midscene AI 智能测试功能
