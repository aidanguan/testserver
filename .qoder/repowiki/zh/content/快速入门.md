# 快速入门

<cite>
**本文档中引用的文件**  
- [README.md](file://README.md)
- [backend/init_db.sql](file://backend/init_db.sql)
- [backend/requirements.txt](file://backend/requirements.txt)
- [backend/main.py](file://backend/main.py)
- [backend/app/config.py](file://backend/app/config.py)
- [frontend/package.json](file://frontend/package.json)
- [frontend/vite.config.js](file://frontend/vite.config.js)
- [frontend/src/api/client.js](file://frontend/src/api/client.js)
</cite>

## 目录
1. [简介](#简介)
2. [前置条件](#前置条件)
3. [数据库初始化](#数据库初始化)
4. [后端服务启动](#后端服务启动)
5. [前端项目启动](#前端项目启动)
6. [首次登录与使用](#首次登录与使用)
7. [常见问题排查](#常见问题排查)

## 简介
本指南旨在帮助新手用户从零开始搭建并运行 `testserver` 系统。该系统是一个基于 Web 的自然语言驱动 UI 测试平台，支持使用自然语言描述测试场景，自动生成并执行 UI 测试用例。

通过本指南，您将完成以下操作：
- 安装必要的运行环境
- 初始化数据库并创建管理员账户
- 启动后端 API 服务
- 启动前端开发服务器
- 登录系统并执行第一个测试用例

所有步骤均基于项目实际文件结构和配置，确保可重复性和准确性。

**Section sources**
- [README.md](file://README.md#L0-L305)

## 前置条件
在开始部署之前，请确保您的系统已安装以下软件及其指定版本：

| 软件 | 版本要求 | 验证命令 |
|------|----------|----------|
| Python | 3.9 或更高版本 | `python --version` |
| Node.js | 16 或更高版本 | `node --version` |
| MySQL | 8.0 或更高版本 | `mysql --version` |
| npm | 8.0 或更高版本（随 Node.js 自动安装） | `npm --version` |

### 验证步骤示例：
```bash
# 检查 Python 版本
python --version

# 检查 Node.js 版本
node --version

# 检查 npm 版本
npm --version

# 检查 MySQL 是否运行
mysql --host=localhost --port=3306 --user=root --password
```

如果任一软件未安装或版本过低，请前往其官方网站下载并安装对应版本。

**Section sources**
- [README.md](file://README.md#L0-L305)

## 数据库初始化
数据库初始化是系统运行的第一步，需创建数据库并导入表结构及默认管理员账户。

### 1. 执行初始化脚本
使用以下命令执行数据库初始化脚本：

```bash
mysql -u root -p < backend/init_db.sql
```

此命令将：
- 创建名为 `ui_test_platform` 的数据库（如不存在）
- 使用 UTF8MB4 字符集以支持完整 Unicode
- 创建核心数据表：用户、项目、测试用例、运行记录等
- 插入默认管理员账户

### 2. 默认管理员账户
脚本会自动创建一个管理员账户，用于首次登录：

- **用户名**：`admin`
- **密码**：`admin`

> **注意**：密码已使用 bcrypt 哈希加密存储，原始明文仅在初始化时有效。

### 3. 验证数据库状态
登录 MySQL 并检查数据库是否创建成功：

```sql
SHOW DATABASES LIKE 'ui_test_platform';
USE ui_test_platform;
SHOW TABLES;
SELECT id, username, role FROM user;
```

预期输出应包含 `user` 表中的一条记录，用户名为 `admin`，角色为 `Admin`。

**Section sources**
- [backend/init_db.sql](file://backend/init_db.sql#L0-L116)
- [README.md](file://README.md#L0-L305)

## 后端服务启动
后端基于 FastAPI 框架构建，提供 RESTful API 接口。

### 1. 安装 Python 依赖
进入 `backend` 目录并安装所需依赖包：

```bash
cd backend
pip install -r requirements.txt
```

关键依赖包括：
- `fastapi` 和 `uvicorn`：Web 服务框架
- `sqlalchemy` 和 `pymysql`：数据库 ORM 与连接器
- `playwright`：自动化浏览器引擎
- `openai` / `anthropic`：LLM 客户端
- `bcrypt`：密码哈希加密

### 2. 安装 Playwright 浏览器
Playwright 需要下载 Chromium 浏览器用于执行 UI 测试：

```bash
playwright install chromium
```

### 3. 配置环境变量（可选）
默认配置已写入 `app/config.py`，若需修改数据库连接信息，请创建 `.env` 文件：

```env
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=ui_test_platform
API_PORT=8000
```

### 4. 启动后端服务
运行主应用文件：

```bash
python main.py
```

服务将在 `http://localhost:8000` 启动，并自动启用热重载模式。

可通过访问以下地址验证服务状态：
- 根路径：`http://localhost:8000` → 返回平台名称和版本
- 健康检查：`http://localhost:8000/health` → 返回 `{"status": "healthy"}`

**Section sources**
- [backend/requirements.txt](file://backend/requirements.txt#L0-L32)
- [backend/main.py](file://backend/main.py#L0-L56)
- [backend/app/config.py](file://backend/app/config.py#L0-L41)

## 前端项目启动
前端基于 Vue 3 和 Vite 构建，提供用户交互界面。

### 1. 安装 Node.js 依赖
进入 `frontend` 目录并安装依赖：

```bash
cd frontend
npm install
```

依赖项包括：
- `vue`、`vue-router`、`pinia`：核心框架与状态管理
- `element-plus`：UI 组件库
- `axios`：HTTP 客户端
- `vite`：构建工具

### 2. 启动开发服务器
启动前端开发服务器：

```bash
npm run dev
```

前端将在 `http://localhost:5173` 启动。

### 3. 代理配置说明
`vite.config.js` 中已配置代理，将 `/api` 请求转发至后端：

```js
proxy: {
  '/api': {
    target: 'http://localhost:8000',
    changeOrigin: true
  }
}
```

这确保了前后端通信无需处理跨域问题。

**Section sources**
- [frontend/package.json](file://frontend/package.json#L0-L23)
- [frontend/vite.config.js](file://frontend/vite.config.js#L0-L21)

## 首次登录与使用
完成前后端启动后，即可访问系统并执行首次测试。

### 1. 访问前端界面
打开浏览器，访问：
```
http://localhost:5173
```

### 2. 登录系统
在登录页面输入默认凭据：
- **用户名**：`admin`
- **密码**：`admin`

点击“登录”按钮，系统将跳转至仪表盘页面。

### 3. 创建第一个项目
1. 进入「项目管理」页面
2. 点击「创建项目」
3. 填写项目信息：
   - 项目名称：`示例项目`
   - 测试站点 URL：`https://example.com`
   - LLM 提供商：选择 `openai` 或 `anthropic`
   - 模型名称：如 `gpt-4`
   - API 密钥：输入您的 LLM API 密钥
4. 点击「保存」

### 4. 创建测试用例
1. 进入项目详情页
2. 点击「创建测试用例」
3. 输入自然语言描述，例如：
   ```
   访问登录页面，输入用户名 admin 和密码 admin，
   点击登录按钮，验证成功跳转到主页
   ```
4. 系统将调用 LLM 自动生成标准化步骤和 Playwright 脚本
5. 点击「保存」

### 5. 执行测试并查看结果
1. 在测试用例列表中点击「执行」
2. 系统将：
   - 启动 Playwright 浏览器
   - 逐步执行脚本
   - 截图每一步操作
   - 采集日志和网络请求
3. 执行完成后，LLM 将自动分析结果并给出判定理由
4. 点击运行记录查看详细报告，包括时间线、截图、日志和判定依据

**Section sources**
- [README.md](file://README.md#L0-L305)
- [frontend/src/api/client.js](file://frontend/src/api/client.js#L0-L44)

## 常见问题排查
在初始化过程中可能遇到以下常见问题，以下是解决方案。

### 1. 数据库连接失败
**现象**：执行 `init_db.sql` 时报错 `Can't connect to MySQL server`
**原因**：MySQL 服务未启动或认证失败
**解决方案**：
- 启动 MySQL 服务：`sudo service mysql start`
- 验证连接：`mysql -u root -p`
- 检查防火墙是否阻止 3306 端口

### 2. 端口冲突
**现象**：后端启动时报错 `Address already in use`
**解决方案**：
- 更改后端端口：修改 `backend/app/config.py` 中的 `API_PORT`
- 或终止占用进程：
  ```bash
  # 查找占用 8000 端口的进程
  lsof -i :8000
  # 终止进程
  kill -9 <PID>
  ```

### 3. Playwright 安装失败
**现象**：`playwright install chromium` 报错网络超时
**解决方案**：
- 使用国内镜像：
  ```bash
  PLAYWRIGHT_DOWNLOAD_HOST=https://npmmirror.com/mirrors/playwright playwright install chromium
  ```

### 4. 前端无法访问后端 API
**现象**：前端报错 `401 Unauthorized` 或 `Network Error`
**解决方案**：
- 确认后端服务正在运行
- 检查 `vite.config.js` 代理配置是否正确
- 确保后端 `.env` 文件中的 `CORS_ORIGINS` 包含 `http://localhost:5173`

### 5. LLM API 调用失败
**现象**：生成测试用例或脚本时报错 `API key invalid`
**解决方案**：
- 检查项目配置中的 LLM API 密钥是否正确
- 确认 API 密钥具有调用权限
- 检查网络是否可访问 OpenAI/Anthropic 服务

**Section sources**
- [README.md](file://README.md#L0-L305)
- [backend/app/config.py](file://backend/app/config.py#L0-L41)
- [frontend/vite.config.js](file://frontend/vite.config.js#L0-L21)