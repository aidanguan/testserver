# 技术栈

<cite>
**本文档引用的文件**  
- [main.py](file://backend/main.py)
- [config.py](file://backend/app/config.py)
- [requirements.txt](file://backend/requirements.txt)
- [database.py](file://backend/app/database.py)
- [security.py](file://backend/app/utils/security.py)
- [auth.py](file://backend/app/api/endpoints/auth.py)
- [llm_service.py](file://backend/app/services/llm_service.py)
- [playwright_executor.py](file://backend/app/services/playwright_executor.py)
- [package.json](file://frontend/package.json)
- [main.js](file://frontend/src/main.js)
- [router/index.js](file://frontend/src/router/index.js)
- [auth.js](file://frontend/src/stores/auth.js)
- [client.js](file://frontend/src/api/client.js)
</cite>

## 目录

1. [引言](#引言)
2. [后端技术栈](#后端技术栈)
   - [FastAPI Web框架](#fastapi-web框架)
   - [SQLAlchemy ORM](#sqlalchemy-orm)
   - [JWT认证机制](#jwt认证机制)
   - [Playwright自动化引擎](#playwright自动化引擎)
   - [LLM服务集成](#llm服务集成)
3. [前端技术栈](#前端技术栈)
   - [Vue 3响应式原理](#vue-3响应式原理)
   - [Pinia状态管理](#pinia状态管理)
   - [Element Plus UI组件库](#element-plus-ui组件库)
   - [Vue Router路由机制](#vue-router路由机制)
   - [Axios API通信](#axios-api通信)
4. [其他关键技术](#其他关键技术)
   - [数据库](#数据库)
   - [构建工具](#构建工具)
   - [加密库](#加密库)
5. [依赖版本与配置查阅](#依赖版本与配置查阅)
6. [总结](#总结)

## 引言

本项目为一个基于自然语言驱动的UI测试平台，采用前后端分离架构。后端使用Python生态构建高性能API服务，前端基于Vue 3实现现代化用户界面。系统集成了LLM（大语言模型）与自动化测试引擎，支持通过自然语言生成测试用例并执行。本文档详细说明项目所采用的技术栈，涵盖前后端核心技术选型、集成方式及配置管理，为开发者提供全面的技术背景与开发指导。

## 后端技术栈

### FastAPI Web框架

FastAPI作为本项目的后端Web框架，提供了高性能、类型安全的API开发能力。其基于Python 3.7+的类型提示特性，结合Starlette异步框架，实现了自动化的API文档生成（Swagger UI）和请求验证。项目通过`main.py`文件初始化FastAPI应用，并配置CORS策略以支持前端跨域访问。所有API路由均通过`include_router`注册到`/api`前缀下，确保接口路径清晰统一。

**Section sources**
- [main.py](file://backend/main.py#L1-L57)
- [app/api/endpoints/auth.py](file://backend/app/api/endpoints/auth.py#L1-L56)

### SQLAlchemy ORM

SQLAlchemy作为对象关系映射（ORM）工具，用于管理与MySQL数据库的交互。项目在`database.py`中配置了数据库引擎、会话工厂和基类，并通过`get_db`依赖注入函数为各API端点提供数据库会话。模型定义位于`models/`目录下，包括用户、项目、测试用例等实体，通过声明式基类继承实现表结构映射。SQLAlchemy的`sessionmaker`配置了自动提交关闭机制，确保资源安全释放。

**Section sources**
- [database.py](file://backend/app/database.py#L1-L33)
- [models/user.py](file://backend/app/models/user.py)
- [models/project.py](file://backend/app/models/project.py)

### JWT认证机制

系统采用JWT（JSON Web Token）实现无状态认证。在`config.py`中定义了JWT密钥、算法和过期时间（默认24小时）。`security.py`封装了密码哈希（bcrypt）、令牌创建与解码功能。用户登录时，系统验证凭据后调用`create_access_token`生成令牌；后续请求通过`Depends(get_current_user)`依赖自动解析并验证令牌。前端在请求头中携带`Authorization: Bearer <token>`完成身份认证。

**Section sources**
- [config.py](file://backend/app/config.py#L25-L30)
- [utils/security.py](file://backend/app/utils/security.py#L1-L44)
- [api/endpoints/auth.py](file://backend/app/api/endpoints/auth.py#L1-L56)

### Playwright自动化引擎

Playwright作为浏览器自动化引擎，负责执行生成的测试脚本。`playwright_executor.py`封装了同步执行器类，支持Chromium、Firefox和WebKit浏览器。执行器根据脚本配置启动无头浏览器，创建上下文和页面，并监听控制台日志。每一步操作（如点击、填写、断言）均封装为独立方法，支持超时控制和自动截屏。执行结果包含步骤状态、错误信息及工件路径（截图、HAR日志等），便于后续分析。

**Section sources**
- [services/playwright_executor.py](file://backend/app/services/playwright_executor.py#L1-L215)

### LLM服务集成

系统集成OpenAI与Anthropic两大LLM服务，通过`llm_service.py`统一管理。`LLMService`类支持多提供商配置，初始化时根据`provider`参数创建对应客户端（OpenAI或Anthropic）。核心功能包括：将自然语言转换为标准化测试用例、生成Playwright脚本、分析测试结果。提示词（prompt）设计遵循结构化JSON输出规范，确保LLM响应可解析。系统通过环境变量管理API密钥，支持灵活切换模型与参数（temperature、max_tokens）。

**Section sources**
- [services/llm_service.py](file://backend/app/services/llm_service.py#L1-L327)

## 前端技术栈

### Vue 3响应式原理

前端采用Vue 3作为核心框架，利用其Composition API和响应式系统实现高效状态管理。`main.js`中通过`createApp`初始化应用，并引入Pinia和Vue Router。响应式数据通过`ref`和`reactive`创建，模板中自动追踪依赖，实现视图自动更新。项目中的认证状态、用户信息等均使用响应式变量，确保跨组件数据同步。

**Section sources**
- [main.js](file://frontend/src/main.js#L1-L27)

### Pinia状态管理

Pinia作为Vue官方推荐的状态管理库，用于集中管理应用级状态。`stores/auth.js`定义了认证存储，包含用户、令牌、认证状态等响应式字段。通过`defineStore`创建存储实例，并暴露`login`、`logout`、`init`等业务方法。状态持久化通过`localStorage`实现，页面刷新后自动恢复登录状态。其他模块（如项目管理）也可类似方式扩展独立存储。

**Section sources**
- [stores/auth.js](file://frontend/src/stores/auth.js#L1-L62)

### Element Plus UI组件库

Element Plus提供了一套现代化的UI组件，用于构建一致的用户界面。项目在`main.js`中全局注册Element Plus及其图标库，确保所有组件可直接使用。组件如`el-button`、`el-form`、`el-table`等广泛应用于登录页、测试用例表单和项目列表。样式通过`import 'element-plus/dist/index.css'`统一引入，支持按需加载优化性能。

**Section sources**
- [main.js](file://frontend/src/main.js#L1-L27)

### Vue Router路由机制

Vue Router实现客户端路由管理，支持嵌套路由和路由守卫。`router/index.js`定义了登录、仪表板、项目详情等路由，并通过`meta.requiresAuth`标记需认证的页面。全局前置守卫`beforeEach`拦截导航，验证令牌存在性，未登录用户自动跳转至登录页。管理员专属页面（如用户管理）通过`meta.requiresAdmin`进一步限制访问权限。

**Section sources**
- [router/index.js](file://frontend/src/router/index.js#L1-L80)

### Axios API通信

Axios用于前后端API通信，封装在`api/client.js`中。`apiClient`实例配置了基础URL（`/api`）、超时时间和默认头。请求拦截器自动添加JWT令牌到`Authorization`头，响应拦截器处理401未授权状态，自动清除本地凭证并重定向至登录页。API方法通过`api/index.js`组织，按模块导出，确保调用清晰可维护。

**Section sources**
- [api/client.js](file://frontend/src/api/client.js#L1-L45)

## 其他关键技术

### 数据库

系统使用MySQL作为持久化存储，通过`pymysql`驱动与SQLAlchemy配合访问。数据库配置（主机、端口、用户名、密码）在`config.py`中定义，支持通过`.env`文件覆盖。表结构由ORM模型自动生成，或通过`init_db.sql`脚本初始化。字符集使用`utf8mb4`以支持完整Unicode。

**Section sources**
- [config.py](file://backend/app/config.py#L10-L18)
- [init_db.sql](file://backend/init_db.sql)

### 构建工具

前端采用Vite作为构建工具，提供快速冷启动和热模块替换（HMR）。`vite.config.js`配置了开发服务器、构建输出等选项。`package.json`中定义了`dev`、`build`、`preview`脚本，支持本地开发、生产构建和预览。Vite插件`@vitejs/plugin-vue`支持Vue单文件组件编译。

**Section sources**
- [vite.config.js](file://frontend/vite.config.js)
- [package.json](file://frontend/package.json#L1-L24)

### 加密库

系统使用`cryptography`和`passlib[bcrypt]`库保障安全。`passlib`提供密码哈希上下文，采用bcrypt算法存储用户密码。`cryptography`支持JWT令牌的加密与解密，确保传输安全。敏感配置（如JWT密钥）建议通过环境变量注入，避免硬编码。

**Section sources**
- [requirements.txt](file://backend/requirements.txt#L10-L12)
- [utils/security.py](file://backend/app/utils/security.py#L1-L44)

## 依赖版本与配置查阅

所有Python依赖版本在`backend/requirements.txt`中明确指定，包括：
- FastAPI 0.104.1
- SQLAlchemy 2.0.23
- PyMySQL 1.1.0
- Playwright 1.40.0
- OpenAI 1.3.7
- cryptography 41.0.7

前端依赖在`frontend/package.json`中定义，主要版本包括：
- Vue 3.4.0
- Vue Router 4.2.5
- Pinia 2.1.7
- Axios 1.6.2
- Element Plus 2.4.4
- Vite 5.0.0

配置参数集中于`backend/app/config.py`，支持通过环境变量覆盖。数据库连接、JWT密钥、CORS来源等均可在`.env`文件中自定义，便于多环境部署。

**Section sources**
- [requirements.txt](file://backend/requirements.txt#L1-L33)
- [package.json](file://frontend/package.json#L1-L24)
- [config.py](file://backend/app/config.py#L1-L42)

## 总结

本项目构建了一个现代化的自然语言驱动UI测试平台，技术栈选型兼顾性能、可维护性与扩展性。后端采用FastAPI+SQLAlchemy+JWT组合，提供安全高效的API服务；前端基于Vue 3+Pinia+Element Plus，实现响应式用户界面；通过Playwright与LLM（OpenAI/Anthropic）深度集成，实现测试自动化智能化。开发者可通过查阅`requirements.txt`和`package.json`获取精确依赖版本，通过`config.py`管理核心配置，快速上手开发与部署。